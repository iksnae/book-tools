% LaTeX template for book-tools
% Based on the default Pandoc LaTeX template
\documentclass[$if(fontsize)$$fontsize$,$endif$$if(papersize)$$papersize$,$endif$$if(twoside)$twoside,$endif$$if(lang)$lang=$lang$,$endif$$for(classoption)$$classoption$$sep$,$endfor$]{$if(documentclass)$$documentclass$$else$book$endif$}

% Packages
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e}
\usepackage[utf8]{inputenc}
\usepackage{eurosym}
\usepackage{fancyhdr}
\usepackage{longtable,booktabs}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage[normalem]{ulem}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage{fontspec}

% For better fonts and typography when using XeLaTeX
\ifxetex
  \usepackage{fontspec,xltxtra,xunicode}
  \defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}
  % Use system fonts instead of requiring specific fonts
  \setmainfont{Times}
  \setsansfont{Helvetica}
  \setmonofont{Courier}
\fi

% Page layout
\usepackage[$for(geometry)$$geometry$$sep$,$endfor$]{geometry}
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines

% Line spacing
$if(linestretch)$
\usepackage{setspace}
\setstretch{$linestretch$}
$endif$

% Header and footer
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[RE]{\itshape $title$}
\fancyhead[LO]{\itshape \leftmark}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}

% Title information
\title{$title$$if(subtitle)$\\\vspace{0.5em}{\large $subtitle$}$endif$}
\author{$for(author)$$author$$sep$ \and $endfor$}
\date{$date$}

% Better table support
\usepackage{longtable,booktabs}
$if(tables)$
\usepackage{longtable,booktabs}
\usepackage{caption}
\captionsetup{skip=1pt}
$endif$

% Graphics handling
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

% Links
\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  citecolor=blue,
  urlcolor=blue,
  breaklinks=true,
  pdfborder={0 0 0},
$if(title-meta)$
  pdftitle={$title-meta$},
$endif$
$if(author-meta)$
  pdfauthor={$author-meta$},
$endif$
$if(keywords)$
  pdfkeywords={$for(keywords)$$keywords$$sep$, $endfor$},
$endif$
$if(colorlinks)$
  colorlinks=true,
  linkcolor=$if(linkcolor)$$linkcolor$$else$blue$endif$,
  citecolor=$if(citecolor)$$citecolor$$else$blue$endif$,
  urlcolor=$if(urlcolor)$$urlcolor$$else$blue$endif$,
$else$
  pdfborder={0 0 0},
$endif$
  breaklinks=true}

% Custom header includes
$for(header-includes)$
$header-includes$
$endfor$

% Begin document
\begin{document}

% Frontmatter
\frontmatter

% Title page
\begin{titlepage}
\begin{center}
\vspace*{4cm}
{\LARGE\textbf{$title$}\par}
\vspace{1cm}
$if(subtitle)$
{\Large $subtitle$\par}
\vspace{1cm}
$endif$
$if(author)$
{\Large $for(author)$$author$$sep$ \and $endfor$\par}
\vspace{1cm}
$endif$
$if(publisher)$
{\large $publisher$\par}
$endif$
\vspace{1cm}
$if(date)$
{\large $date$\par}
$endif$
\end{center}
\end{titlepage}

% Optional copyright page
$if(rights)$
\newpage
\thispagestyle{empty}
\vspace*{\fill}
\begin{center}
$rights$
\end{center}
\vspace*{\fill}
$endif$

% Table of contents
$if(toc)$
{
\hypersetup{linkcolor=black}
\setcounter{tocdepth}{$toc-depth$}
\tableofcontents
}
$endif$

% Main content
\mainmatter
$body$

% Back matter
\backmatter

\end{document} 